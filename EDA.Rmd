---
title: Analisi esplorativa di dati economici di No Man's Sky
author: "Francesco Tranquillo"
date: "14 agosto 2018"
output:

  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    css: "custom.css"
  pdf_document: default
  html_document:
    df_print: paged
    always_allow_html: yes

menu: TRUE
order: 6
---
<style type="text/css">
h1.title {
  font-size: 38px;
}
</style>
```{r, echo=FALSE, warning= FALSE, message= FALSE}
library(plotly)
library(ggplot2)
library(reshape2)
library(plyr)
library(ggpubr)
library(gridExtra)
library(tidyverse)
library(ggridges)
setwd("C://Users//Fra//Documents//Projects")
df<-read.csv("nmseco.csv", header = TRUE, sep = ",", dec= ",", stringsAsFactors = FALSE)




df$Dominant.Race<-as.factor(df$Dominant.Race)
df$Economy.Type<-as.factor(df$Economy.Type)
df$Sell....<-as.numeric(df$Sell....)
df$Buy....<-as.numeric(df$Buy....)
df$Total<-as.numeric(df$Total)
df$Economy.Strength.Numeric<-as.factor(df$Economy.Strength.Numeric)
df$Economy.Strength<-as.factor(df$Economy.Strength)
df$Conflict.Level<-as.factor((df$Conflict.Level))
df$Star.Colour<-as.factor(df$Star.Colour)

df$Economy.Strength.Numeric<- revalue(df$Economy.Strength.Numeric,c("1"="Povero","2"="Medio","3"="Ricco"))

cols<-c("Blue"="#00aedb", "Green"="#00b159", "Red"="#d11141", "Yellow"="#ffc425")
ric<-c("3"="Rich","2"="Average","1"="Poor")
razze<-c("greenyellow","royalblue", "coral2")

```
<div style="page-break-after: always;"></div>
# Frequenza delle razze: C'è una razza più frequente nell'universo?
<center>
```{r, echo=FALSE, warning= FALSE, message= FALSE}


ggplotly(ggplot(df, aes(Dominant.Race))+
           geom_bar(alpha=0.7,aes(fill=Dominant.Race), width = 0.6)+
           scale_fill_manual(name= "Razza \nDominante", values=c("Gek"="greenyellow","Korvax"="royalblue", "Vy'keen"="coral2"))+
           geom_text(stat="count", aes(label=..count.., y=..count..+2))+
           ylab("Contegggio")+
           xlab("Razza Dominante")+
           ggtitle("Frequenza delle razze dominanti")+

           theme_classic()


           #axis.text.y = element_blank(), axis.ticks.y = element_blank()
)
```
</center>
Non sembra esserci una razza dominante.


# C'è una razza più "ricca"?
Si sa, i Vy'keen sono onorevoli guerrieri, i Korvax sono dediti alla scienza e alla loro "Convergenza", mentre i Gek sono abili commercianti. Analizziamo quindi i dati commerciali dei loro sistemi per scoprire se effettivamente i Gek sono abili nel commercio.
<center>
```{r, echo=FALSE, message=FALSE, warning=FALSE}
p1<-ggplot(df, aes(Dominant.Race, Total))+
           geom_boxplot(aes(fill=Dominant.Race))+
           geom_point(alpha=0.8,aes(fill=Dominant.Race))+
           geom_jitter(alpha=.5 ,aes(fill=Dominant.Race), width = 0.1)+
           scale_fill_manual(values=c("Gek"="greenyellow","Korvax"="royalblue", "Vy'keen"="coral2"))+
           scale_colour_manual(values=c("Gek"="greenyellow","Korvax"="royalblue", "Vy'keen"="coral2"))+
           theme_classic()+
  coord_flip()
pa<-ggplotly(p1)
p2<-ggplot(df, aes(Total))+
  geom_density(aes(fill=Dominant.Race), alpha=0.5)+
  scale_fill_manual(values=razze)+
  theme(legend.position="none",axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank()
)
pb<-ggplotly(p2)



p<-subplot(pb,pa, nrows = 2, shareX = TRUE, heights = c(0.2,0.7))
p<-style(p, showlegend=FALSE)
p
```
</center>
Nel grafico i Gek hanno una più alta densità di sistemi con una percentuale commerciale totale pari al 90%. Inoltre si può notare come le loro percentuali si concentrino intorno all'85% circa, seguiti da Korvax (81%) e Vy'keen (78%).

Nonostante i pochi dati a disposizione, i Gek sembrano davvero essere meritevoli del primato economico!
<div style="page-break-after: always;"></div>


# Distribuzione della ricchezza galattica
Come è distribuita la ricchezza nella galassia?
<center>
```{r,echo=FALSE, warning= FALSE, message= FALSE}


dfriccanza<-count(df, Economy.Strength, Economy.Strength.Numeric)
ggplotly(ggplot(dfriccanza, aes(reorder(Economy.Strength, -n, sum), n))+
           geom_bar(stat="identity",alpha=0.8,position="dodge", aes(fill=Economy.Strength.Numeric), width = 0.6)+
           geom_text(stat="identity", aes(label=n, y=n+1), size=3)+
           theme_classic()+
           coord_flip()+
           xlab("Forza dell'economia")+
           ggtitle("Frequenza dei sistemi ricchi, medi e poveri")+
           scale_fill_brewer(palette= "BuPu", name="Valutazione \neconomica")
)
```
</center>
I sistemi "medi" sono molto più frequenti di quelli poveri, che sono a loro volta più frequenti di quelli ricchi.
Tutto sommato, la galassia di Euclide non è un brutto posto per i commercianti.

# Forza economica VS Ricchezza: i sistemi più ricchi, hanno davvero percentuali commercialipiù alte?
Verrebbe da pensare che i sistemi "Ricchi" siano appunto tali da essere caratterizzati da indici economici migliori rispetto agli altri sistemi. Verifichiamolo!
<center>
```{r,echo=FALSE, warning= FALSE, message= FALSE}
dfricchi<-df[df$Economy.Strength.Numeric=="Povero",]
p1<-ggplot(dfricchi, aes(Total, Economy.Strength))+
           geom_density_ridges_gradient(aes(fill=..x..))+
  scale_fill_gradientn(colours = c("#E0ECF4", "#C3CDDD", "#ACAEC4"))+
  theme_classic()

dfricchi<-df[df$Economy.Strength.Numeric=="Medio",]
p2<-ggplot(dfricchi, aes(Total, Economy.Strength))+
  geom_density_ridges_gradient(aes(fill=..x..))+
  scale_fill_gradientn(colours = c("#E6F4F1", "#95A6CC", "#0B3048"))+
  theme_classic()

dfricchi<-df[df$Economy.Strength.Numeric=="Ricco",]
p3<-ggplot(dfricchi, aes(Total, Economy.Strength))+
  geom_density_ridges_gradient(aes(fill=..x..))+
  scale_fill_gradientn(colours = c("#FFF5FF", "#A287B0", "#8856A7"))+
  theme_classic()

p4<-grid.arrange(p1,p2,p3, ncol=1, nrow=3)


```
</center>
sembra di sì, dal grafico di densità di Ridge, si può dedurre che i sistemi ricchi presentano una più alta densità di valori percentuali tra l'80% e il 90%.
<div style="page-break-after: always;"></div>


#Che colore hanno i sistemi con le percentuali commerciali più alte?

Avendo a disposizione i dati, possiamo indagare la relazione tra:

* La statistica "Totale": somma delle percentuali di vendita e di acqusito di un sistema
* Il colore del sistema stellare
<center>
```{r,echo=FALSE, warning= FALSE, message= FALSE}

ggplotly(ggplot(df, aes(Star.Colour, Total))+
           geom_point(aes(fill=Star.Colour))+
           geom_jitter(alpha=0.4, aes(fill=Star.Colour), width = 0.3)+
           geom_violin(alpha=0.3,  aes(fill=Star.Colour))+
           geom_boxplot(alpha=0.2, aes(fill=Star.Colour))+
           #geom_bar(stat="bin",aes(fill=Star.Colour), position="dodge")+
           scale_fill_manual(values=cols)+
           theme_classic()+
           xlab("Colore della stella")+
           ylab("%Totale = %vendita + %acquisto") +
           theme(legend.position = "none")


)

```
</center>
Dal grafico si può dedurre che:

* <b>Sistemi gialli</b>: caratterizzati da percentuali commerciali totali distribuite in modo omogeneo con una dispersione maggiore rispetto agli altri sistemi nel range 55% - 105%. Questo può essere dovuto al fatto che, numericamente parlando, sono i sistemi più comuni

* <b>Sistemi Verdi</b>: hanno percentuali mediamente più alte in un range più stretto rispetto a quelli gialli. Inoltre presentano una densità maggiore di percentuali intorno all'85% rispetto a tutti gli altri sistemi. In futuri studi sarebbe da indagare la possibilità che questi sistemi siano "migliori" per il commercio.

* <b>Sistemi Blu </b>: similmente rispetto ai sistemi verdi, sono caratterizzati da percentuali distribuite su un range più ristretto, tuttavia le percentuali estreme osservate risultano minori di quelle dei sistemi verdi.

* <b>Sistemi Rossi </b>: interessante notare che, nei dati, è presente un solo salto (su 200) effettuato in un sistema rosso non disabitato. Interessante anche notare l'alta percentuale presente in quel sistema
